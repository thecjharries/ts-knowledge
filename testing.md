# Testing

## Stack

* [Mocha](//mochajs.org/) pulls everything together
* [Chai](//chaijs.com) adds some sugar
* [`chai-as-promised`](//github.com/domenic/chai-as-promised) adds promise support to Chai
* [Sinon](//sinonjs.org) adds powerful stubbing
* [Mockery](//github.com/mfncooper/mockery) allows `require` mocking on libraries like [`request`](//github.com/request/request)
* [nyc](//github.com/istanbuljs/nyc) provides code coverage (Its the [Istanbul](//istanbul.js.org) CLI)

```bash
npm install --save-dev \
    mocha @types/mocha mocha-typescript \
    chai @types/chai \
    chai-as-promised @types/chai-as-promised \
    sinon @types/sinon \
    mockery @types/mockery \
    nyc
```

## Config

### App Structure
```
coverage/ - Autogenerated by nyc
src/ - All source files
test/ - All specs, named *.spec.ts
    mocha.opts - The Mocha options file
package.json

```

### `package.json` (for `nyc`)

```json
{
    ...
    "nyc": {
        "include": [
          "src/**/*.ts"
        ],
        "extension": [
          ".ts"
        ],
        "require": [
          "ts-node/register"
        ],
        "reporter": [
          "json",
          "html",
          "text-summary"
        ],
        "all": true
    },
    ...
}
```

### `mocha.opts`

```
--recursive
--reporter spec
--ui mocha-typescript
--require source-map-support/register
--compilers ts:ts-node/register
--bail
--watch-extensions ts
```

## A Basic Test

`src/TestableClass.ts`
```typescript
export class TestableClass {
    public constructor() {
        // do nothing
    }

    public returnFortySeven(): number {
        return 47;
    }

    public promiseToReturnFortySeven(): Promise<number> {
        return Promise.resolve(this.returnFortySeven());
    }
}
```
`test/TestableClass.spec.ts`
```typescript
// Things like ...be.true; or ...be.rejected; dont play nice with TSLint
/* tslint:disable:no-unused-expression */
import * as chai from "chai";
import * as sinon from "sinon";

// I personally use should.
const assert = chai.assert;
const expect = chai.expect;
const should = chai.should();
/* tslint:disable-next-line:no-var-requires */
chai.use(require("chai-as-promised"));

import { TestableClass } from "../src/TestableClass"

describe("Testable class", () => {
    let 
});
```